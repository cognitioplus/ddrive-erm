<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDRiVE-M Platform</title>
    <!-- PWA Metadata -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0F4C81">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <!-- Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Core React Stack (Loaded first) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Required for Recharts UMD to find React globals -->
    <script>
        window.React = React;
        window.ReactDOM = ReactDOM;
    </script>
    <script src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    <script src="https://unpkg.com/lucide@0.378.0/dist/umd/lucide.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-[#F8FAFC]">
    <div id="root"></div>

    <script type="text/babel">
        // Import components from global namespaces
        const { useState, useEffect, useMemo } = React;
        
        // Safely access Recharts components from window.Recharts
        const { 
            LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, 
            AreaChart, Area, BarChart, Bar, PieChart, Pie, Cell 
        } = window.Recharts || {};

        // Lucide Icon Wrapper
        const Icon = ({ name, size = 20, className = "" }) => {
            const LucideIcon = lucide.icons[name] || lucide.icons.HelpCircle;
            return <LucideIcon size={size} className={className} />;
        };

        // --- PWA Service Worker Registration ---
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW Registered'))
                    .catch(err => console.log('SW Registration Failed', err));
            });
        }

        // --- Constants ---
        const PILLARS = [
            { id: 'detection', name: 'Detection', icon: 'Radio', desc: 'Real-time threat identification' },
            { id: 'diagnostics', name: 'Diagnostics', icon: 'BarChart3', desc: 'Root cause analysis' },
            { id: 'response', name: 'Response', icon: 'Target', desc: 'Incident management' },
            { id: 'integration', name: 'Integration', icon: 'Zap', desc: 'Data synchronization' },
            { id: 'validation', name: 'Validation', icon: 'CheckCircle2', desc: 'Capability testing' },
            { id: 'enhancement', name: 'Enhancement', icon: 'BrainCircuit', desc: 'Adaptive learning' },
            { id: 'monitoring', name: 'Monitoring', icon: 'Activity', desc: 'Resilience tracking' },
        ];

        // --- Official Logo Component ---
        const DDRiVELogo = ({ className = "", iconOnly = false }) => {
            return (
                <svg viewBox={iconOnly ? "0 0 80 80" : "0 0 500 120"} className={className}>
                    <defs>
                        <linearGradient id="blueGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style={{ stopColor: "#0F4C81" }} />
                            <stop offset="100%" style={{ stopColor: "#1B75BC" }} />
                        </linearGradient>
                    </defs>
                    {iconOnly ? (
                        <g>
                            <circle cx="40" cy="40" r="38" fill="none" stroke="url(#blueGrad)" strokeWidth="4"/>
                            <path d="M40 15 L65 30 L65 50 L40 65 L15 50 L15 30 Z" fill="url(#blueGrad)" />
                            <path d="M40 25 L55 35 L55 45 L40 55 L25 45 L25 35 Z" fill="white" />
                        </g>
                    ) : (
                        <g>
                            <g transform="translate(10, 20)">
                                <circle cx="40" cy="40" r="38" fill="none" stroke="url(#blueGrad)" strokeWidth="4"/>
                                <path d="M40 15 L65 30 L65 50 L40 65 L15 50 L15 30 Z" fill="url(#blueGrad)" />
                                <path d="M40 25 L55 35 L55 45 L40 55 L25 45 L25 35 Z" fill="white" />
                            </g>
                            <text x="105" y="65" fontFamily="Arial" fontWeight="bold" fontSize="52" fill="#0F4C81">DDR<tspan fill="#1B75BC">i</tspan>VE-M</text>
                            <text x="108" y="88" fontFamily="Arial" fontWeight="bold" fontSize="10" fill="#64748b" letterSpacing="1">DATA-DRIVEN RISK & VULNERABILITY EVALUATION AND MANAGEMENT</text>
                        </g>
                    )}
                </svg>
            );
        };

        // --- Authentication ---
        const LoginScreen = ({ onLogin }) => {
            const [user, setUser] = useState({ email: '', password: '' });
            const [error, setError] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                if (user.email === 'admin@ddrive-m.com' && user.password === 'resilience2025') {
                    onLogin({ name: 'Command Admin', email: user.email });
                } else {
                    setError('Invalid credentials. (Try: admin@ddrive-m.com / resilience2025)');
                }
            };

            return (
                <div className="min-h-screen bg-slate-50 flex items-center justify-center p-6">
                    <div className="w-full max-w-md bg-white rounded-[2.5rem] shadow-2xl p-10 border border-slate-100">
                        <div className="flex justify-center mb-8"><DDRiVELogo className="h-16 w-auto" iconOnly /></div>
                        <form onSubmit={handleSubmit} className="space-y-6">
                            <div className="space-y-2">
                                <label className="text-[10px] font-black uppercase text-slate-400 ml-4 tracking-widest">Identifier</label>
                                <input type="email" placeholder="Email" required className="w-full px-6 py-4 bg-slate-50 border rounded-2xl focus:ring-2 ring-blue-500 outline-none transition-all" value={user.email} onChange={e => setUser({...user, email: e.target.value})} />
                            </div>
                            <div className="space-y-2">
                                <label className="text-[10px] font-black uppercase text-slate-400 ml-4 tracking-widest">Access Key</label>
                                <input type="password" placeholder="Password" required className="w-full px-6 py-4 bg-slate-50 border rounded-2xl focus:ring-2 ring-blue-500 outline-none transition-all" value={user.password} onChange={e => setUser({...user, password: e.target.value})} />
                            </div>
                            {error && <p className="text-xs text-rose-500 font-bold text-center bg-rose-50 p-3 rounded-xl">{error}</p>}
                            <button className="w-full py-4 bg-slate-900 hover:bg-black text-white rounded-2xl font-black uppercase text-xs tracking-widest transition-colors">Authenticate</button>
                        </form>
                    </div>
                </div>
            );
        };

        // --- Main App Component ---
        function App() {
            const [currentUser, setCurrentUser] = useState(null);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [isSidebarCollapsed, setSidebarCollapsed] = useState(false);
            const [aiPrompt, setAiPrompt] = useState("");
            const [aiResponse, setAiResponse] = useState(null);
            const [isAiLoading, setIsAiLoading] = useState(false);

            if (!currentUser) return <LoginScreen onLogin={setCurrentUser} />;

            const handleAiInquiry = () => {
                if (!aiPrompt.trim()) return;
                setIsAiLoading(true);
                setTimeout(() => {
                    setAiResponse("Intelligence Analysis: Based on current telemetry, recommend strengthening Sector 7 flood barriers and recalibrating seismic sensors in the Eastern corridor.");
                    setIsAiLoading(false);
                }, 1500);
            };

            return (
                <div className="flex h-screen overflow-hidden bg-[#F8FAFC]">
                    {/* Sidebar */}
                    <aside className={`${isSidebarCollapsed ? 'w-24' : 'w-72'} bg-[#F1F5F9] border-r border-slate-200 transition-all duration-300 flex flex-col`}>
                        <div className="p-6 h-24 flex items-center justify-center">
                            <DDRiVELogo className="h-10 w-auto" iconOnly={isSidebarCollapsed} />
                        </div>
                        <nav className="flex-1 p-4 space-y-2 overflow-y-auto scrollbar-hide">
                            <button onClick={() => setActiveTab('dashboard')} className={`w-full flex items-center gap-3 p-4 rounded-2xl transition-all ${activeTab === 'dashboard' ? 'bg-white text-blue-600 shadow-md font-bold' : 'text-slate-500 hover:bg-slate-200'}`}>
                                <Icon name="Radar" />
                                {!isSidebarCollapsed && <span className="text-sm">Command Center</span>}
                            </button>
                            <div className="h-px bg-slate-200 my-4"></div>
                            {PILLARS.map(p => (
                                <button key={p.id} onClick={() => setActiveTab(p.id)} title={p.desc} className={`w-full flex items-center gap-3 p-4 rounded-2xl transition-all ${activeTab === p.id ? 'bg-white text-blue-600 shadow-sm font-bold' : 'text-slate-500 hover:bg-slate-200'}`}>
                                    <Icon name={p.icon} size={18} />
                                    {!isSidebarCollapsed && <span className="text-sm">{p.name}</span>}
                                </button>
                            ))}
                        </nav>
                        <div className="p-4">
                            <button onClick={() => setSidebarCollapsed(!isSidebarCollapsed)} className="w-full flex justify-center p-3 bg-white border rounded-xl text-slate-400 hover:text-blue-600 transition-colors">
                                <Icon name={isSidebarCollapsed ? 'ChevronRight' : 'ChevronLeft'} />
                            </button>
                        </div>
                    </aside>

                    {/* Main Content Area */}
                    <main className="flex-1 overflow-y-auto">
                        <header className="h-24 bg-white border-b px-10 flex items-center justify-between sticky top-0 z-30 shadow-sm">
                            <h2 className="text-2xl font-black capitalize tracking-tight">{activeTab.replace('_', ' ')}</h2>
                            <div className="flex items-center gap-6">
                                <button className="relative p-2 text-slate-400 hover:text-slate-600">
                                    <Icon name="Bell" />
                                    <span className="absolute top-0 right-0 h-2 w-2 bg-rose-500 rounded-full border-2 border-white"></span>
                                </button>
                                <div className="flex items-center gap-3 pl-4 border-l">
                                    <div className="text-right hidden sm:block">
                                        <p className="text-xs font-bold text-slate-900">{currentUser.name}</p>
                                        <p className="text-[10px] text-slate-400 font-medium">Platform Admin</p>
                                    </div>
                                    <div className="h-10 w-10 bg-blue-600 rounded-xl text-white flex items-center justify-center font-bold shadow-lg shadow-blue-100">
                                        AD
                                    </div>
                                </div>
                            </div>
                        </header>

                        <div className="p-10 max-w-7xl mx-auto space-y-8">
                            {/* Dashboard View */}
                            {activeTab === 'dashboard' && (
                                <div className="space-y-8 animate-in fade-in duration-500">
                                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                                        {[
                                            { label: 'Critical Hazards', val: '04', color: 'text-rose-600', sub: 'High Priority' },
                                            { label: 'Active Sensors', val: '1,248', color: 'text-emerald-600', sub: '98% Uptime' },
                                            { label: 'Resilience Score', val: '84%', color: 'text-blue-600', sub: 'Improving' },
                                            { label: 'Readiness Level', val: 'Alpha', color: 'text-amber-600', sub: 'Full Capacity' }
                                        ].map((stat, i) => (
                                            <div key={i} className="bg-white p-6 rounded-3xl border shadow-sm hover:shadow-md transition-shadow">
                                                <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">{stat.label}</p>
                                                <h3 className={`text-3xl font-black ${stat.color}`}>{stat.val}</h3>
                                                <p className="text-[10px] font-medium text-slate-400 mt-1">{stat.sub}</p>
                                            </div>
                                        ))}
                                    </div>
                                    <div className="bg-white p-8 rounded-[2.5rem] border shadow-sm">
                                        <div className="flex items-center justify-between mb-8">
                                            <h3 className="font-bold text-slate-800">Risk Forecast & Intelligence</h3>
                                        </div>
                                        <div className="h-72">
                                            {AreaChart ? (
                                                <ResponsiveContainer width="100%" height="100%">
                                                    <AreaChart data={[
                                                        {n:'Oct', r:40}, {n:'Nov', r:55}, 
                                                        {n:'Dec', r:48}, {n:'Jan', r:70},
                                                        {n:'Feb', r:62}, {n:'Mar', r:75}
                                                    ]}>
                                                        <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f1f5f9" />
                                                        <XAxis dataKey="n" axisLine={false} tickLine={false} tick={{fontSize: 10, fontWeight: 700}} dy={10} />
                                                        <YAxis hide />
                                                        <Tooltip contentStyle={{borderRadius: '16px', border: 'none', boxShadow: '0 10px 15px -3px rgb(0 0 0 / 0.1)'}} />
                                                        <Area type="monotone" dataKey="r" stroke="#1B75BC" strokeWidth={3} fill="#3B82F6" fillOpacity={0.1} />
                                                    </AreaChart>
                                                </ResponsiveContainer>
                                            ) : (
                                                <div className="h-full flex items-center justify-center text-slate-300 italic">Charting module loading...</div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Enhancement / AI View */}
                            {activeTab === 'enhancement' && (
                                <div className="max-w-2xl mx-auto space-y-8 animate-in slide-in-from-bottom-4 duration-500">
                                    <div className="text-center space-y-3">
                                        <div className="inline-flex p-4 bg-blue-50 rounded-3xl text-blue-600 mb-2">
                                            <Icon name="BrainCircuit" size={32} />
                                        </div>
                                        <h3 className="text-3xl font-black tracking-tight">Adaptive Learning AI</h3>
                                        <p className="text-slate-500 text-sm">Query the DDRiVE-M engine for predictive insights and tactical advice.</p>
                                    </div>
                                    <div className="bg-white p-8 rounded-[2.5rem] border shadow-xl">
                                        <textarea 
                                            className="w-full bg-slate-50 border border-slate-100 rounded-3xl p-6 text-sm outline-none resize-none mb-4 focus:ring-2 ring-blue-500 transition-all min-h-[120px]" 
                                            placeholder="Example: What are the primary risk vectors for the coastal energy grid in Q2?"
                                            value={aiPrompt}
                                            onChange={(e) => setAiPrompt(e.target.value)}
                                        />
                                        <button 
                                            onClick={handleAiInquiry} 
                                            disabled={isAiLoading || !aiPrompt.trim()}
                                            className="w-full py-4 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 text-white rounded-2xl font-bold transition-colors flex items-center justify-center gap-2"
                                        >
                                            {isAiLoading ? "Synthesizing Data..." : "Execute Intelligence Query"}
                                        </button>
                                        
                                        {aiResponse && (
                                            <div className="mt-8 animate-in fade-in slide-in-from-top-2">
                                                <div className="flex items-center gap-2 text-[10px] font-black text-blue-600 uppercase tracking-widest mb-3">
                                                    <Icon name="Cpu" size={14} /> Intelligence Output
                                                </div>
                                                <div className="p-6 bg-slate-50 border border-slate-100 rounded-2xl text-slate-700 text-sm leading-relaxed">
                                                    {aiResponse}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            )}

                            {/* Placeholder for other tabs */}
                            {activeTab !== 'dashboard' && activeTab !== 'enhancement' && (
                                <div className="bg-white p-20 rounded-[2.5rem] border border-dashed flex flex-col items-center justify-center text-center space-y-4">
                                    <div className="p-4 bg-slate-50 rounded-full text-slate-300">
                                        <Icon name={PILLARS.find(p => p.id === activeTab)?.icon || 'FileText'} size={48} />
                                    </div>
                                    <div>
                                        <h4 className="font-bold text-slate-800">System Ready</h4>
                                        <p className="text-slate-400 text-sm italic">
                                            The {activeTab} module is successfully initialized and polling live telemetry.
                                        </p>
                                    </div>
                                    <button onClick={() => setActiveTab('dashboard')} className="px-6 py-2 bg-slate-100 hover:bg-slate-200 rounded-xl text-xs font-bold text-slate-600 transition-colors">Return to Dashboard</button>
                                </div>
                            )}
                        </div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
